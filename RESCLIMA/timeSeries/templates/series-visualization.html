{% extends 'main/base.html' %}
{% load static %}

{% block title%}RESCLIMA | VISUALIZAR SERIES DE TIEMPO{% endblock %}

{% block scripts %}
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
{% endblock %}

{% block content %}
<body>
  
  <div id="div1"></div>
  <div id="div2"></div>

</body>
{% endblock content %}

{% block scripts_body %}
<script type="text/javascript">
   // data_from_django = {{ measurements }};
   //get data from url
   var urlParams = new URLSearchParams(window.location.search);
   console.log(urlParams.get("variables"));
   //parse data
var variables_info = urlParams.split("|");
var params = {}
var imax = variables_info.length
for(var i=0 ; i<imax ; i++){
	//get the variable id
	var current = variables_info[i];
	var variable_id = current.charAt(0);
	//get variables of stations
	var estaciones_str = current.slice(2,current.length-1);
	var estaciones = estaciones_str.split(",");
	params[variable_id] = estaciones;
}

for(var key in params){
	//make an ajax request per variable
	$.ajax({ url : "http://127.0.0.1:8000/series/", 
		type:"get", 
		// handle a successful response 
		success : function(json) { 
			console.log(json);
			//here goes plotly
      variableTimeSerie();
			},
     //else
		error : function(data) {
		 console.log("oh no :("); 
		 	} 
	 });	
}

//Plotly.newPlot('div2', data, layout2);
  
 function variableTimeSerie(){
    
  var trace1 = {
  x: [1, 2, 3, 4], 
  y: [10, 15, 13, 17], 
  type: 'scatter'
};
var trace2 = {
  x: [1, 2, 3, 4], 
  y: [16, 5, 11, 9], 
  type: 'scatter'
};
var data = [trace1, trace2];

var layout1 = {
  yaxis: {rangemode: 'tozero',
          showline: true,
          zeroline: true}
};

var layout2 = {
  yaxis: {rangemode: 'tozero',
          zeroline: true}
};

Plotly.newPlot('div1', data, layout1);
   }
    
</script>
{% endblock %}
