{% load static %}

<html lang="es">
	<head>
		<title></title>
		<meta charset="utf-8">
		<meta name="description" content="Clasifica secciones de la hoja de banano">
		<script src="{% static "jquery.js" %}" type= "text/javascript"></script>
		<script src="{% static "OpenLayers.js" %}" type= "text/javascript"></script>
	</head>
	<body>
		<div id="map" style="width:100%;height: 700px;">

		</div>
		
	</body>
	<script>
		var layer_id = {{rasterlayer.id}}
		var bbox = {{bbox|safe}}
		bbox = JSON.parse(bbox)
		
		function getExtent(bbox_json){
			var geojson_format = new OpenLayers.Format.GeoJSON();
			var polygon = geojson_format.read(bbox_json)[0];
			polygon.geometry.transform('EPSG:4326','EPSG:900913');
			var coords = polygon.geometry.components[0]
			coords = coords.components
			var minX,minY,maxX,maxY
			minX = coords[0]["x"]
			minY = coords[0]["y"]
			maxX = coords[2]["x"]
			maxY = coords[2]["y"]
			console.log(minX,minY,maxX,maxY)
			return [minX,minY,maxX,maxY]
		}



		function renderMap(){


			var map = new OpenLayers.Map(
				{
					div:"map",
					projection:"EPSG:3857",
					displayProjection: new OpenLayers.Projection("EPSG:4326"),
					numZoomLevels:11,
					units: 'm'
				});
			
			var osm = new OpenLayers.Layer.OSM("OSM");
			map.addLayer(osm);
			var extent = getExtent(bbox);
			map.zoomToExtent(extent);

			// se pide la capa
            var layer = new OpenLayers.Layer.TMS('TMS',
                    "/tms/",
                    {serviceVersion: "1.0",
                    layername: layer_id,
                    type: 'png',
                    isBaseLayer: false
            })
            layer.opacity = 0.7
           	map.addLayer(layer);
		}


		function init(){		
			renderMap();
		}

		window.addEventListener("load",init);
	</script>
</html>